(this["webpackJsonpreact-piano-recording-playback-demo"]=this["webpackJsonpreact-piano-recording-playback-demo"]||[]).push([[0],{48:function(t,e,n){},51:function(t,e,n){"use strict";n.r(e);var o=n(16),r=n(21),i=n(4),s=n(5),a=n(7),c=n(6),u=n(12),d=n.n(u),p=n(2),l=n.n(p),m=n(17),f=n.n(m),h=n(13),b=n.n(h),g=n(3),j=(n(31),n(18)),v=n.n(j),N=n(1),y=function(t){Object(a.a)(n,t);var e=Object(c.a)(n);function n(){return Object(i.a)(this,n),e.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return Object(N.jsx)("div",{children:this.props.children({containerWidth:this.props.containerWidth,containerHeight:this.props.containerHeight})})}}]),n}(l.a.Component),O=v()()(y),x=n(8),C=n(19),R=n.n(C),k=function(t){Object(a.a)(n,t);var e=Object(c.a)(n);function n(t){var o;return Object(i.a)(this,n),(o=e.call(this,t)).loadInstrument=function(t){o.setState({instrument:null}),R.a.instrument(o.props.audioContext,t,{format:o.props.format,soundfont:o.props.soundfont,nameToUrl:function(t,e,n){return"".concat(o.props.hostname,"/").concat(e,"/").concat(t,"-").concat(n,".js")}}).then((function(t){o.setState({instrument:t})}))},o.playNote=function(t){o.props.audioContext.resume().then((function(){var e=o.state.instrument.play(t);o.setState({activeAudioNodes:Object.assign({},o.state.activeAudioNodes,Object(x.a)({},t,e))})}))},o.stopNote=function(t){o.props.audioContext.resume().then((function(){o.state.activeAudioNodes[t]&&(o.state.activeAudioNodes[t].stop(),o.setState({activeAudioNodes:Object.assign({},o.state.activeAudioNodes,Object(x.a)({},t,null))}))}))},o.stopAllNotes=function(){o.props.audioContext.resume().then((function(){Object.values(o.state.activeAudioNodes).forEach((function(t){t&&t.stop()})),o.setState({activeAudioNodes:{}})}))},o.state={activeAudioNodes:{},instrument:null},o}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.loadInstrument(this.props.instrumentName)}},{key:"componentDidUpdate",value:function(t,e){t.instrumentName!==this.props.instrumentName&&this.loadInstrument(this.props.instrumentName)}},{key:"render",value:function(){return this.props.render({isLoading:!this.state.instrument,playNote:this.playNote,stopNote:this.stopNote,stopAllNotes:this.stopAllNotes})}}]),n}(l.a.Component);k.defaultProps={format:"mp3",soundfont:"MusyngKite",instrumentName:"acoustic_grand_piano"};var T=k,E=n(20),S=n(22),A=["playNote","stopNote","recording","setRecording"],I=function(t){Object(a.a)(n,t);var e=Object(c.a)(n);function n(){var t;Object(i.a)(this,n);for(var o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return(t=e.call.apply(e,[this].concat(r))).state={keysDown:{},noteDuration:.2,playing:!1},t.onPlayNoteInput=function(e){if(!t.state.playing){var n=new Date;t.setState({notesRecorded:!1,startTime:n.getTime(),playing:!0}),console.log("startTime",t.state.startTime)}},t.onStopNoteInput=function(e,n){var o=n.prevActiveNotes;if(!1!==t.state.playing){var r=new Date;console.log("endTime",r.getTime()),console.log("diff",r.getTime()-t.state.startTime),!1===t.state.notesRecorded&&(t.setState({noteDuration:(r.getTime()-t.state.startTime)/1e3,playing:!1,notesRecorded:!0}),t.recordNotes(o,t.state.noteDuration))}},t.recordNotes=function(e,n){if("RECORDING"===t.props.recording.mode){var o=e.map((function(e){return{midiNumber:e,time:t.props.recording.currentTime,duration:n}}));t.props.setRecording({events:t.props.recording.events.concat(o),currentTime:t.props.recording.currentTime+n})}},t}return Object(s.a)(n,[{key:"render",value:function(){var t=this.props,e=(t.playNote,t.stopNote,t.recording,t.setRecording,Object(S.a)(t,A)),n=this.props.recording,o=n.mode,r=n.currentEvents,i="PLAYING"===o?r.map((function(t){return t.midiNumber})):null;return Object(N.jsx)("div",{children:Object(N.jsx)(g.c,Object(E.a)({playNote:this.props.playNote,stopNote:this.props.stopNote,onPlayNoteInput:this.onPlayNoteInput,onStopNoteInput:this.onStopNoteInput,activeNotes:i},e))})}}]),n}(l.a.Component);I.defaultProps={notesRecorded:!1,startTime:0};var w=I,D=(n(48),new(window.AudioContext||window.webkitAudioContext)),P="http://159.89.126.155:5000/",M=n(49),_={first:g.b.fromNote("c3"),last:g.b.fromNote("f4")},G=g.a.create({firstNote:_.first,lastNote:_.last,keyboardConfig:g.a.HOME_ROW});function L(){return Object(N.jsxs)("div",{children:[Object(N.jsx)("div",{className:"logo",children:Object(N.jsx)("center",{children:Object(N.jsx)("img",{src:"https://i.ibb.co/pnNq9cX/Untitled-1.jpg"})})}),Object(N.jsx)("div",{children:Object(N.jsx)(H,{})})]})}var H=function(t){Object(a.a)(n,t);var e=Object(c.a)(n);function n(t){var s;return Object(i.a)(this,n),(s=e.call(this,t)).state={recording:{mode:"RECORDING",events:[],currentTime:0,currentEvents:[]}},s.getRecordingEndTime=function(){return 0===s.state.recording.events.length?0:Math.max.apply(Math,Object(r.a)(s.state.recording.events.map((function(t){return t.time+t.duration}))))},s.setRecording=function(t){s.setState({recording:Object.assign({},s.state.recording,t)})},s.onClickPlay=function(){s.setRecording({mode:"PLAYING"}),b.a.uniq(b.a.flatMap(s.state.recording.events,(function(t){return[t.time,t.time+t.duration]}))).forEach((function(t){s.scheduledEvents.push(setTimeout((function(){var e=s.state.recording.events.filter((function(e){return e.time<=t&&e.time+e.duration>t}));s.setRecording({currentEvents:e})}),1e3*t))})),setTimeout((function(){s.onClickStop()}),1e3*s.getRecordingEndTime())},s.onClickStop=function(){s.scheduledEvents.forEach((function(t){clearTimeout(t)})),s.setRecording({mode:"RECORDING",currentEvents:[]})},s.onClickClear=function(){s.onClickStop(),s.setRecording({events:[],mode:"RECORDING",currentEvents:[],currentTime:0})},s.onClickChange=function(){s.noteRange={first:g.b.fromNote("c3"),last:g.b.fromNote("f5")},s.keyboardShortcuts=g.a.create({firstNote:_.first,lastNote:_.last,keyboardConfig:g.a.HOME_ROW})},s.onClickML=Object(o.a)(d.a.mark((function t(){var e,n,o,r,i,a,c,u,p,l;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=document.querySelector("#loader"),n=document.querySelector(".buttonBody"),o=document.getElementById("audio-player"),e.style.display="block",n.style.display="none",o.style.display="none",r=s.state.recording.events.map((function(t){return t.duration})),i=s.state.recording.events.map((function(t){return t.midiNumber})),a={pitch:i,duration:r},t.next=11,fetch(P+"generate_midi",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)});case 11:return c=t.sent,t.next=14,c.text();case 14:return u=t.sent,u=M.basename(u),t.next=18,fetch(P+"get_mp3",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({file_name:u})});case 18:return p=t.sent,t.next=21,p.text();case 21:l=t.sent,o.style.display="block",o.src=P+"".concat(l),e.style.display="none",n.style.display="block",s.setRecording({events:[],mode:"RECORDING",currentEvents:[],currentTime:0});case 27:case"end":return t.stop()}}),t)}))),s.scheduledEvents=[],s}return Object(s.a)(n,[{key:"render",value:function(){var t=this;return Object(N.jsx)(O,{children:function(e){var n=e.containerWidth;e.containerHeight;return Object(N.jsxs)("div",{children:[Object(N.jsx)("div",{className:"piano",children:Object(N.jsx)(T,{instrumentName:"acoustic_grand_piano",audioContext:D,hostname:"https://d1pzp51pvbm36p.cloudfront.net",render:function(e){var o=e.isLoading,r=e.playNote,i=e.stopNote;return Object(N.jsx)(w,{recording:t.state.recording,setRecording:t.setRecording,noteRange:_,width:.75*n,playNote:r,stopNote:i,disabled:o,keyboardShortcuts:G})}})}),Object(N.jsx)("div",{className:"buttonBody",children:Object(N.jsx)("button",{onClick:t.onClickML,disabled:0==t.state.recording.events.length,children:"Generate"})}),Object(N.jsx)("div",{id:"loader"}),Object(N.jsx)("center",{children:Object(N.jsxs)("audio",{id:"audio-player",controls:!0,src:"",children:["Your browser does not support the",Object(N.jsx)("code",{children:"audio"})," element."]})})]})}})}}]),n}(l.a.Component),W=document.getElementById("root");f.a.render(Object(N.jsx)(L,{}),W)}},[[51,1,2]]]);
//# sourceMappingURL=main.a89dac3f.chunk.js.map